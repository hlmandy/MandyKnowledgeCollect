[TOC]

## 几种经典的decision tree

C4.5 是 ID3的升级。ID3是 information gain (交叉熵)； C4.5 是 gain ratio。C5.0是再升级，应该更快，但是用的人不多。

用的最多的是C4.5 和CART。sklearn用的是CART（原因可能是既能分类又能回归）。ORANGE用的是C4.5，R包有C5.0。

C4.5 是多叉树，把树的构造转化为rule set（可能更方便或者更快）

CART是**二叉树**，且包含了**misclassification cost**，怎么影响每个步骤的在Breiman 1984那本书里面，很难看懂

> CART不一定比C4.5更准确，看起来分类问题C4.5更加准确一些

### CART决策树(Breiman 1984) —— Gini Index

> CART: classification and regression tree
>
> 既可以用来分类，也可以用来回归

CART 假设决策树是二叉树，左边为是，右边为否。

**步骤：**

1. 生成决策树
2. 决策树剪枝

#### 基尼系数：反映了从一个集合里面，随机抽取两个样本，类别不一致的概率

$$\begin{aligned}\operatorname{Gini}(D)&=\sum_{k=1}^{|y|}\sum_{{k'}\neq k}{p_k}{p_{k'}}\\
&=1-\sum_{k=1}^{|y|}p_k^2
\end{aligned}$$

那么属性 $a$ 的基尼系数为：

$$\operatorname{Gini\_index}(D,a) = \sum_{v=1}^{V}\frac{|D^v|}{|D|}\operatorname{Gini}(D^v)$$

> 注意！实际上CART用的是misclassification cost。只有当cost相同的时候，才是gini

#### Class assignment rule (from model to rule) `CART1984-sec 2.4.3`每个node是哪个class？

1. 不考虑数据imbalance的默认做法是：每个leaf node $t$ 的类别由数量最多的决定：$max_j p(j|t)$。如果 $p(j_0|t)=max_j p(j|t)$，则这个leaf node的类别为 $j_0$。

2. 如果考虑imbalance，则以misclassification cost最小的类别标记该叶子节点。

   具体操作如下：

   如果标记 $c(i|j)$ 为当把class j 分成 class i 的成本，且 

- $c(i|j)\ge 0, i \neq j$

- $c(i|j)=0, i=j$

  则如果把这个leaf node分为 i， misclassification的总成本为

  $\sum_j c(i|j)p(j|t)$

  所以就要找到 $i_0$，使得上式最小。

  正式定义：

  $r(t) = min_i\sum_j c(i|j)p(j|t)$

  该树的总 misclassification cost is:

  $R(T) = \sum_{t\in\tilde{T}}r(t)p(t) = \sum_{t\in\tilde{T}}R(t)$

  其中，$\tilde{T}$ 表示leaf nodes 集合。 

#### cost-sensitive CART

其实早在CART树里面，就考虑了非对称的misclassification cost这个问题。

<u>CART认为在生成树的过程中，使用Gini更好；而在prune的时候，则考虑misclassification cost</u>

(第四章有提到，在生成树的时候，splitting用什么方法没多大差别。)

**注意，CART里面还提到了一个prior参数，没看懂。既然说生成树区别不大，暂且跳过**





## sklearn

sklearn 里面的class_weight是怎么实现的，写的非常不清楚，网上也有很多人在问

[scikit learn - How does class_weight work in Decision Tree - Data Science Stack Exchange](https://datascience.stackexchange.com/questions/56250/how-does-class-weight-work-in-decision-tree#:~:text=The statistics for the child nodes are weighted,on its class according to its class proportion.)



大致应该是：在计算impurity improvement 的时候，把weight加上去了



