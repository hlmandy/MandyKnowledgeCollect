## 连接MySQL数据库

### 使用 pymysql 模块

参考：

pymysql官网：https://github.com/PyMySQL/PyMySQL

#### 安装

```bash
pip install pymysql
```

### 基本使用

```python
# 导入pymysql模块
import pymysql
import pymysql.cursors
# 连接database
connection = pymysql.connect(host='localhost',
                             user='user',
                             password='passwd',
                             database='db',
                             cursorclass=pymysql.cursors.DictCursor)
# 得到一个可以执行SQL语句的光标对象
cursor = conn.cursor()
# 定义要执行的SQL语句
sql = """
CREATE TABLE USER1 (
id INT auto_increment PRIMARY KEY ,
name CHAR(10) NOT NULL UNIQUE,
age TINYINT NOT NULL
)ENGINE=innodb DEFAULT CHARSET=utf8;
"""
# 执行SQL语句
cursor.execute(sql)
# 关闭光标对象
cursor.close()
# 关闭数据库连接
conn.close()
```



### Alter Table

增加多个字段：

```python
ALTER TABLE `test11` ADD COLUMN (
        `ucid` bigint(20) NOT NULL DEFAULT 0 COMMENT '线索ucid',
        `clue_type` int(11) NOT NULL  DEFAULT '1' COMMENT '线索类型1招生 2招商',
        `work_type` int(11) NOT NULL  DEFAULT 0 COMMENT '线索工种',
        `allottime` TIMESTAMP not null DEFAULT CURRENT_TIMESTAMP COMMENT '分单时间',
        `allot_admin_id` int(11) NOT NULL   DEFAULT 0 COMMENT '分单人id',
        `allot_store_id` int(11) NOT NULL   DEFAULT 0 COMMENT '分单门店'
)
```

删除多个字段：

```python
ALTER TABLE `test11` DROP `clue_type`,DROP `work_type`,DROP `ucid`;
```

修改字段：

```python
ALTER TABLE `test11` modify COLUMN  `ucid` bigint(20) NOT NULL DEFAULT 0 COMMENT '线索ucid';
ALTER TABLE `test11` modify COLUMN `clue_type` int(1) NOT NULL  DEFAULT '1' COMMENT '线索类型1招生 2招商';
ALTER TABLE `test11` modify COLUMN `work_type` int(3) NOT NULL  DEFAULT 0 COMMENT '线索工种';
```







### python封装数据库连接函数

```python
import pymysql
import pymysql.cursors
class mysqldb():
    conn = None

    def connect_db(self):
        db_host = "11.168.3.235"
        user = "scal_maintenance"
        pw = "123@umax"
        dbname = "scal_maintenance"
        try:
            # 创建连接数据库
            self.conn = pymysql.connect(db_host, user, pw, dbname, cursorclass=pymysql.cursors.DictCursor)
            return self.conn
        except Exception as e:
            print("数据库连接异常！错误%s", e)
            return None

```

## MySQL数据库语法

### 时间相关

```mysql
UNIX_TIMESTAMP(后timestamp) - UNIX_TIMESTAMP(前timestamp) # 秒数
DATE_SUB(NOW(),INTERVAL 1 DAY)	# 当前时间减一天
DATE_ADD(NOW(),INTERVAL 1 DAY)	# 当前时间加一天

```

