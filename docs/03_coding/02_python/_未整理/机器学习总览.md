
## 数据描述

参考：book `Hands-on Machine Learning with Scikit-Learn, Keras, and TensorFlow  `

### 需要考虑变量的内生性vs.外生性



### 1. 使用pandas、matplotlib等工具查看数据

#### 直方图
![](_assets/image-20210929155136079.png)

观察是否出现截断数据、量纲不对的数据等

如果长尾，可能需要对数据进行转换，以获得钟形数据



### 数据处理

#### 连续数据离散化

```python
pandas.cut()
```

在测试数据与训练数据切分时可能需要分层处理。



#### 特征工程

1. 数据清理--缺失值处理
    ```python
    housing.dropna(subset=["total_bedrooms"]) # option 1--把含缺失值的数据删除
    housing.drop("total_bedrooms", axis=1) # option 2--放弃属性
    median = housing["total_bedrooms"].median() # option 3--将缺失值填充为某个值
    housing["total_bedrooms"].fillna(median, inplace=True)
    ## option 3 的替代方法
    from sklearn.impute import SimpleImputer
    imputer = SimpleImputer(strategy="median")
    housing_num = housing.drop("ocean_proximity", axis=1)    # 只保留数值变量计算imputer
    imputer.fit(housing_num)
    ```
    ```python
    >>> imputer.statistics_
    array([ -118.51 , 34.26 , 29. , 2119.5 , 433. , 1164. , 408. , 3.5409])
    >>> housing_num.median().values
    array([ -118.51 , 34.26 , 29. , 2119.5 , 433. , 1164. , 408. , 3.5409])
    ```
    ```python
    # 缺失值转换
    X = imputer.transform(housing_num)  # numpy
    housing_tr = pd.DataFrame(X, columns=housing_num.columns,index=housing_num.index)  # pandas
    ```
2. 处理分类变量
    ```python
    >>> from sklearn.preprocessing import OrdinalEncoder
    >>> ordinal_encoder = OrdinalEncoder()   # 转换成1,2,3,4....
    >>> housing_cat_encoded = ordinal_encoder.fit_transform(housing_cat)
    >>> housing_cat_encoded[:10]
    >>> ordinal_encoder.categories_
    [array(['<1H OCEAN', 'INLAND', 'ISLAND', 'NEAR BAY', 'NEAR OCEAN'],
    dtype=object)]
    # one-hot编码
    >>> from sklearn.preprocessing import OneHotEncoder
    >>> cat_encoder = OneHotEncoder()
    >>> housing_cat_1hot = cat_encoder.fit_transform(housing_cat)
    >>> housing_cat_1hot
    <16512x5 sparse matrix of type '<class 'numpy.float64'>'
    with 16512 stored elements in Compressed Sparse Row format>
    >>> housing_cat_1hot.toarray()
    array([[1., 0., 0., 0., 0.],
    [1., 0., 0., 0., 0.],
    [0., 0., 0., 0., 1.],
    ...,
    [0., 1., 0., 0., 0.],
    [1., 0., 0., 0., 0.],
    [0., 0., 0., 1., 0.]])
    >>> cat_encoder.categories_
    [array(['<1H OCEAN', 'INLAND', 'ISLAND', 'NEAR BAY', 'NEAR OCEAN'],
    dtype=object)]
    ```

3. 特征缩放
- 3.1 min-max 归一化 将值重新缩放使其最终范围归于0～1之间。实现方法是将值减去最小值并除以最大值和最小值的差。
MinMaxScaler
- 3.2 标准化 StandadScaler

4. Pipeline
   除了最后一个是估算器之外，前面都必须是转换器（也就是说，必须有fit_transform（）方法
    ```python
    from sklearn.pipeline import Pipeline
    from sklearn.preprocessing import StandardScaler
    num_pipeline = Pipeline([
    ('imputer', SimpleImputer(strategy="median")),
    ('attribs_adder', CombinedAttributesAdder()),
    ('std_scaler', StandardScaler()),
    ])
    housing_num_tr = num_pipeline.fit_transform(housing_num)
    ```
